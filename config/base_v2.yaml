# Global default config for CV + full-train (aligned to v2 loss architecture)

experiment:
  name: base_newloss

model:
  type: mask2former_v2

  # Transformer
  num_queries: 15
  d_model: 256
  nhead: 8
  num_decoder_layers: 6
  dim_feedforward: 2048
  dropout: 0.1
  activation: relu
  mask_dim: 256

  # Backbone + FPN
  backbone_name: convnext_tiny
  pretrained_backbone: true
  backbone_trainable: true
  fpn_out_channels: 256

  # Hungarian matching costs
  cost_bce: 1.0
  cost_dice: 1.0

  # Loss weights (new architecture)
  # 1) matched mask loss = BCE + Dice
  # 2) query cls BCE (matched=1, unmatched=0)
  # 3) presence BCE vs image_label
  # 4) authentic suppression penalty (qscore mean on authentic)
  loss_weight_mask_bce: 1.0
  loss_weight_mask_dice: 1.0
  loss_weight_mask_cls: 1.0
  loss_weight_presence: 1.0
  loss_weight_auth_penalty: 1.0

  # Scales the suppression term on authentic images
  authenticity_penalty_weight: 1.0

  # Inference defaults (train-aligned; optional post-filtering)
  default_mask_threshold: 0.5
  default_qscore_threshold: null
  default_topk: null
  default_min_mask_mass: null
  default_presence_threshold: null

trainer:
  name: baseline
  epochs: 20
  batch_size: 4
  lr: 1.0e-4
  weight_decay: 1.0e-4

  # CV-only
  n_folds: 3
  out_dir: experiments/oof_results

  # Full-train-only
  save_path: weights/full_train/model_full_data_baseline.pth

wandb:
  project: mask2former-forgery
  entity: null
  mode: online
