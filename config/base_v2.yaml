# Global default config for CV + full-train (aligned to v2 loss architecture)

experiment:
  name: base_loss_v3

data:
  img_size: 512

model:
  type: mask2former_v2
    # Backbone
  backbone_name: convnext_base   # convnext_small / base / large
  pretrained_backbone: true
  backbone_trainable: true

  # Hungarian matching costs
  cost_bce: 1.0
  cost_dice: 1.0
  cost_qscore: 0.0   # optional: bias matching toward high-qscore queries

  # Loss weights 
  loss_weight_mask_bce: 1.0
  loss_weight_mask_dice: 1.0
  loss_weight_mask_cls: 1.0
  loss_weight_presence: 1.0
  loss_weight_auth_penalty: 1.0

  # Scales the suppression term on authentic images
  authenticity_penalty_weight: 1.0

  # Sparsity / regularization (train-time)
  few_queries_lambda: 0.10
  presence_lse_beta: 10.0
  tv_lambda: 0.05
  
  # Class BCE balancing / discourage extras
  cls_neg_pos_ratio: 8
  cls_neg_weight: 0.25
  cls_unmatched_multiplier: 2.0

  # Logging thresholds for sparsity diagnostics
  sparsity_thresholds: [0.05, 0.10, 0.20]

  # Inference defaults (train-aligned; optional post-filtering)
  default_mask_threshold: 0.5
  default_qscore_threshold: null
  default_topk: 2
  default_min_mask_mass: 0.001
  default_presence_threshold: null

trainer:
  name: baseline
  epochs: 20
  batch_size: 4
  lr: 1.0e-4
  weight_decay: 1.0e-4

  # CV-only
  n_folds: 3
  out_dir: experiments/oof_results

  # Full-train-only
  save_path: weights/full_train/model_full_data_baseline.pth

wandb:
  project: mask2former-forgery
  entity: null
  mode: online
